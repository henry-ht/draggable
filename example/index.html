<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draggable</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="css/app.css">
</head>
<body class="pt-5">
    <div class="container">
        <section class="row" >
            <div class="col-md-4">
                <div id="container-draggable" ></div>
                <!-- <div id="container-draggable" >
                    <ul class="list-group">
                        <li class="list-group-item im-draggable" id="draggable-1" >
                            <div class="btn-group w-100" >
                                <button class="btn btn-light btn-sm btn-draggable-move" >
                                    <i class="fa-solid fa-up-down"></i>
                                </button>
                                <button class="btn btn-draggable-toggle w-100 text-start" data-bs-toggle="collapse" data-bs-target="#collapse-1" aria-expanded="false" >
                                    A disabled item
                                </button>
                                <button class="btn btn-light btn-sm" >
                                    <i class="fa-regular fa-trash-can"></i>
                                </button>
                                <button class="btn btn-light btn-sm" >
                                    <i class="fa-regular fa-pen-to-square"></i>
                                </button>
                            </div>
                            <div class="collapse ps-4 mt-1" id="collapse-1" >
                                <ul class="list-group list-group-flush small">
                                    <li class="list-group-item im-draggable" id="draggable-2">
                                        <div class="btn-group w-100">
                                            <button class="btn btn-light btn-sm btn-draggable-move" >
                                                <i class="fa-solid fa-up-down"></i>
                                            </button>
                                            <button class="btn w-100 text-start btn-draggable">
                                                A disabled item
                                            </button>
                                            <button class="btn btn-light btn-sm" >
                                                <i class="fa-regular fa-trash-can"></i>
                                            </button>
                                            <button class="btn btn-light btn-sm" >
                                                <i class="fa-regular fa-pen-to-square"></i>
                                            </button>
                                        </div>
                                        <div class="ms-auto w-75 border-bottom border-info border-2 border-draggable"></div>
                                    </li>
                                    <li class="list-group-item im-draggable" id="draggable-3">
                                        <div class="btn-group w-100">
                                            <button class="btn btn-light btn-sm btn-draggable-move" >
                                                <i class="fa-solid fa-up-down"></i>
                                            </button>
                                            <button class="btn w-100 text-start btn-draggable">
                                                A disabled item
                                            </button>
                                            <button class="btn btn-light btn-sm" >
                                                <i class="fa-regular fa-trash-can"></i>
                                            </button>
                                            <button class="btn btn-light btn-sm" >
                                                <i class="fa-regular fa-pen-to-square"></i>
                                            </button>
                                        </div>
                                        <div class="ms-auto w-75 border-bottom border-info border-2 border-draggable"></div>
                                    </li>
                                    <li class="list-group-item im-draggable" id="draggable-4">
                                        <div class="btn-group w-100">
                                            <button class="btn btn-light btn-sm btn-draggable-move" >
                                                <i class="fa-solid fa-up-down"></i>
                                            </button>
                                            <button class="btn w-100 text-start btn-draggable">
                                                A disabled item
                                            </button>
                                            <button class="btn btn-light btn-sm" >
                                                <i class="fa-regular fa-trash-can"></i>
                                            </button>
                                            <button class="btn btn-light btn-sm" >
                                                <i class="fa-regular fa-pen-to-square"></i>
                                            </button>
                                        </div>
                                        <div class="ms-auto w-75 border-bottom border-info border-2 border-draggable"></div>
                                    </li>
                                    <li class="list-group-item im-draggable" id="draggable-5">
                                        <div class="btn-group w-100">
                                            <button class="btn btn-light btn-sm btn-draggable-move" >
                                                <i class="fa-solid fa-up-down"></i>
                                            </button>
                                            <button class="btn w-100 text-start btn-draggable">
                                                A disabled item
                                            </button>
                                            <button class="btn btn-light btn-sm" >
                                                <i class="fa-regular fa-trash-can"></i>
                                            </button>
                                            <button class="btn btn-light btn-sm" >
                                                <i class="fa-regular fa-pen-to-square"></i>
                                            </button>
                                        </div>
                                        <div class="ms-auto w-75 border-bottom border-info border-2 border-draggable"></div>
                                    </li>
                                    <li class="list-group-item im-draggable" id="draggable-6" >
                                        <div class="btn-group w-100">
                                            <button class="btn btn-light btn-sm btn-draggable-move" >
                                                <i class="fa-solid fa-up-down"></i>
                                            </button>
                                            <button class="btn w-100 text-start btn-draggable">
                                                A disabled item
                                            </button>
                                            <button class="btn btn-light btn-sm" >
                                                <i class="fa-regular fa-trash-can"></i>
                                            </button>
                                            <button class="btn btn-light btn-sm" >
                                                <i class="fa-regular fa-pen-to-square"></i>
                                            </button>
                                        </div>
                                        <div class="ms-auto w-75 border-bottom border-info border-2 border-draggable"></div>
                                    </li>
                                </ul>
                            </div>
                            <div class="ms-auto w-75 border-bottom border-info border-2 border-draggable"></div>
                        </li>
                        <li class="list-group-item im-draggable" id="draggable-7" >
                            <div class="btn-group w-100">
                                <button class="btn btn-light btn-sm btn-draggable-move" >
                                    <i class="fa-solid fa-up-down"></i>
                                </button>
                                <button class="btn w-100 text-start btn-draggable">
                                    A disabled item
                                </button>
                                <button class="btn btn-light btn-sm" >
                                    <i class="fa-regular fa-trash-can"></i>
                                </button>
                                <button class="btn btn-light btn-sm" >
                                    <i class="fa-regular fa-pen-to-square"></i>
                                </button>
                            </div>
                            <div class="ms-auto w-75 border-bottom border-info border-2 border-draggable"></div>
                        </li>
                        <li class="list-group-item im-draggable" id="draggable-8">
                            <div class="btn-group w-100">
                                <button class="btn btn-light btn-sm btn-draggable-move" >
                                    <i class="fa-solid fa-up-down"></i>
                                </button>
                                <button class="btn w-100 text-start btn-draggable">
                                    A disabled item
                                </button>
                                <button class="btn btn-light btn-sm" >
                                    <i class="fa-regular fa-trash-can"></i>
                                </button>
                                <button class="btn btn-light btn-sm" >
                                    <i class="fa-regular fa-pen-to-square"></i>
                                </button>
                            </div>
                            <div class="ms-auto w-75 border-bottom border-info border-2 border-draggable"></div>
                        </li>
                        <li class="list-group-item im-draggable" id="draggable-9" >
                            <div class="btn-group w-100">
                                <button class="btn btn-light btn-sm btn-draggable-move" >
                                    <i class="fa-solid fa-up-down"></i>
                                </button>
                                <button class="btn w-100 text-start btn-draggable">
                                    A disabled item
                                </button>
                                <button class="btn btn-light btn-sm" >
                                    <i class="fa-regular fa-trash-can"></i>
                                </button>
                                <button class="btn btn-light btn-sm" >
                                    <i class="fa-regular fa-pen-to-square"></i>
                                </button>
                            </div>
                            <div class="ms-auto w-75 border-bottom border-info border-2 border-draggable"></div>
                        </li>
                        <li class="list-group-item im-draggable" id="draggable-10">
                            <div class="btn-group w-100">
                                <button class="btn btn-light btn-sm btn-draggable-move" >
                                    <i class="fa-solid fa-up-down"></i>
                                </button>
                                <button class="btn w-100 text-start btn-draggable">
                                    A disabled item
                                </button>
                                <button class="btn btn-light btn-sm" >
                                    <i class="fa-regular fa-trash-can"></i>
                                </button>
                                <button class="btn btn-light btn-sm" >
                                    <i class="fa-regular fa-pen-to-square"></i>
                                </button>
                            </div>
                            <div class="ms-auto w-75 border-bottom border-info border-2 border-draggable"></div>
                        </li>
                    </ul>
                </div> -->
            </div>
        </section>
    </div>
    <script type="module">
        import Draggable from '../dist-browser/draggable.js';
        window.Draggable = Draggable;
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const tree = [
                { 
                    id: 1,
                    name: 'apples',
                    description: "lorem lorem",
                    children: [] 
                },
                { 
                    id: 2,
                    name: 'vegetables', 
                    children: [] 
                },
                { 
                    id: 3,
                    name: 'pomelo', 
                    children: [
                        { 
                            id: 7,
                            name: 'apples 2', 
                            description: "lorem lorem",
                            children: [] 
                        },
                        { 
                            id: 8,
                            name: 'apples 3', 
                            children: [] 
                        },
                    ] 
                },
                { 
                    id: 4,
                    name: 'oranges', 
                    children: [] 
                },
                { 
                    id: 5,
                    name: 'fruits', 
                    children: [
                        { 
                            id: 9,
                            name: 'fornic', 
                            children: [] 
                        },
                        { 
                            id: 10,
                            name: 'goku', 
                            children: [] 
                        },
                    ] 
                },
                { 
                    id: 6,
                    name: 'brocolli', 
                    description: "lorem lorem",
                    children: [] 
                },
            ];

            const drag = new Draggable(tree);

            drag.actions = function (data) {
                //console.log("actions: ", data)
            }

            drag.success = function (data) {
                //console.log("urraa success: ", data)
                //console.log("class: ", drag.getOrder());
            }
            //setTimeout(()=>{
                //drag.delete(8);
                //console.log("count: ", drag.getOrder());
            //}, 1000);
        });
    </script>
    <!-- const createElement = (tagName, attrs = {}) => {
                const element = document.createElement(tagName);
                for (let key in attrs) {
                    element.setAttribute(key, attrs[key]);
                }
                return element;
            }

            treview = (items, containerDraggable, child = false) => {
                const ulParent = createElement("ul", {
                    "class": (child ? "list-group list-group-flush small" : "list-group")
                });

                items.forEach(item => {
                    const li = createElement("li", {
                        "class": "list-group-item im-draggable",
                        "id": "draggable-"+item.id
                    });
                    const btnGroup = createElement("div", {
                        "class": "btn-group w-100",
                    });

                    const btnDraggable = createElement("button", {
                        "class": "btn btn-light btn-sm btn-draggable-move",
                    });
                    const btnDraggableIcon = createElement("i", {
                        "class": "fa-solid fa-up-down",
                    });
                    btnDraggable.append(btnDraggableIcon);

                    const btnCollapse = createElement("button", {
                        "class": "btn "+( item.children.length ? "btn-draggable-toggle" : "btn-draggable")+" w-100 text-start",
                        "data-bs-toggle": "collapse", 
                        "data-bs-target": "#collapse-"+item.id, 
                        "aria-expanded": "false"
                    });
                    btnCollapse.textContent = item.name;

                    const btnTrash = createElement("button", {
                        "class": "btn btn-light btn-sm",
                    });
                    const btnTrashIcon = createElement("i", {
                        "class": "fa-regular fa-trash-can",
                    });
                    btnTrash.append(btnTrashIcon);

                    const btnEdit = createElement("button", {
                        "class": "btn btn-light btn-sm",
                    });
                    const btnEditIcon = createElement("i", {
                        "class": "fa-regular fa-pen-to-square",
                    });
                    btnEdit.append(btnEditIcon);

                    btnGroup.append(btnDraggable);
                    btnGroup.append(btnCollapse);
                    btnGroup.append(btnTrash);
                    btnGroup.append(btnEdit);

                    const borderSelect = createElement("div", {
                        "class": "ms-auto w-75 border-bottom border-info border-2 border-draggable",
                    });
                    
                    li.append(btnGroup);
                    if(item.children.length){
                        const collapseContent = createElement("div", {
                            "class": "collapse ps-4 mt-1",
                            "id": "collapse-"+item.id
                        });
                        treview(item.children, collapseContent, true);
                        li.append(collapseContent);
                    }
                    li.append(borderSelect);
                    ulParent.append(li);
                });

                containerDraggable.append(ulParent);
            }

            treview(tree, document.getElementById('container-draggable'));

            const items = document.querySelectorAll('#container-draggable li button.btn-draggable-move');
            
            items.forEach(item => {
                item.addEventListener('mousedown', fnMousedown);
                item.addEventListener('mouseup', fnMouseup);
                //item.addEventListener('touchstart', fnMousedown);
                //item.addEventListener('touchend', fnMouseup);
            });

            function fnMousedown(e) {
                let parent = e.target.parentElement.closest("li.im-draggable");
                parent.setAttribute("draggable", "true");
                parent.addEventListener('dragstart', dragStart);
            }

            function fnMouseup(e) {
                let parent = e.target.parentElement.closest("li.im-draggable");
                parent.removeAttribute("draggable", "true");
                parent.removeEventListener('dragstart', dragStart);
            }
            
            function dragStart(e) {
                e.dataTransfer.setData('text/plain', e.target.id);
            }

            const boxes = document.querySelectorAll('#container-draggable ul');

            boxes.forEach(box => {
                box.addEventListener('dragenter', dragEnter)
                box.addEventListener('dragover', dragOver);
                box.addEventListener('dragleave', dragLeave);
                box.addEventListener('drop', drop);
            });

            function dragEnter(e) {
                e.preventDefault();
                if(e.target.tagName == "LI"){
                    e.target.classList.add('im-draggable-selected');
                }
            }

            function dragOver(e) {
                e.preventDefault();
                if(e.target.tagName == "LI"){
                    e.target.classList.add('im-draggable-selected');
                }
            }

            function dragLeave(e) {
                if(e.target.tagName == "LI"){
                    e.target.classList.remove('im-draggable-selected');
                }
            }

            function drop(e) {
                if(e.target.tagName == "LI"){
                    e.target.classList.remove('im-draggable-selected');
                    const id = e.dataTransfer.getData('text/plain');
                    const draggable = document.getElementById(id);
                    const parent = e.target.parentNode;
                    parent.insertBefore(draggable, e.target.nextSibling ?? e.target);
                }
            } -->
</body>
</html>